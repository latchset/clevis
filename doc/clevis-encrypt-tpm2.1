'\" t
.\"     Title: clevis-encrypt-tpm2
.\"    Author: [FIXME: author] [see http://www.docbook.org/tdg5/en/html/author]
.\" Generator: DocBook XSL Stylesheets vsnapshot <http://docbook.sf.net/>
.\"      Date: 07/12/2018
.\"    Manual: \ \&
.\"    Source: \ \&
.\"  Language: English
.\"
.TH "CLEVIS\-ENCRYPT\-TPM" "1" "07/12/2018" "\ \&" "\ \&"
.\" -----------------------------------------------------------------
.\" * Define some portability stuff
.\" -----------------------------------------------------------------
.\" ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
.\" http://bugs.debian.org/507673
.\" http://lists.gnu.org/archive/html/groff/2009-02/msg00013.html
.\" ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\" -----------------------------------------------------------------
.\" * set default formatting
.\" -----------------------------------------------------------------
.\" disable hyphenation
.nh
.\" disable justification (adjust text to left margin only)
.ad l
.\" -----------------------------------------------------------------
.\" * MAIN CONTENT STARTS HERE *
.\" -----------------------------------------------------------------
.SH "NAME"
clevis-encrypt-tpm2 \- Encrypts using a TPM2\&.0 chip binding policy
.SH "SYNOPSIS"
.sp
\fBclevis encrypt tpm2\fR CONFIG < PT > JWE
.SH "OVERVIEW"
.sp
The \fBclevis encrypt tpm2\fR command encrypts using a Trusted Platform Module 2\&.0 (TPM2) chip\&. Its only argument is the JSON configuration object\&.
.sp
When using the tpm2 pin, we create a new, cryptographically\-strong, random key\&. This key is encrypted using the TPM2 chip\&. Then at decryption time, the key is decrypted again using the TPM2 chip\&.
.sp
.if n \{\
.RS 4
.\}
.nf
$ clevis encrypt tpm2 \*(Aq{}\*(Aq < PT > JWE
.fi
.if n \{\
.RE
.\}
.sp
The pin has reasonable defaults for its configuration, but a different hierarchy, hash, and key algorithms can be chosen if the defaults used are not suitable:
.sp
.if n \{\
.RS 4
.\}
.nf
$ clevis encrypt tpm2 \*(Aq{"hash":"sha1","key":"rsa"}\*(Aq < PT > JWE
.fi
.if n \{\
.RE
.\}
.sp
To decrypt the data, simply provide the ciphertext (JWE):
.sp
.if n \{\
.RS 4
.\}
.nf
$ clevis decrypt < JWE > PT
.fi
.if n \{\
.RE
.\}
.sp
Note that like other pins no configuration is used for decryption, this is due clevis storing the public and private keys to unseal the TPM2 encrypted object in the JWE so clevis can fetch that information from there\&.
.sp
The pin also supports sealing data to a Platform Configuration Registers (PCR) state\&. That way the data can only be unsealed if the PCRs hashes values match the policy used when sealing\&.
.sp
For example, to seal the data to the PCR with index 0 and 1 for the SHA1 bank:
.sp
.if n \{\
.RS 4
.\}
.nf
$ clevis encrypt tpm2 \*(Aq{"pcr_bank":"sha1","pcr_ids":"0,1"}\*(Aq < PT > JWE
.fi
.if n \{\
.RE
.\}
.sp
The PCR digest values are looked up from the current hash values for the PCRs, but a digest can also be provided if the data needs to be sealed with values different to the current ones, by passing the binary hash encoded in base64:
.sp
.if n \{\
.RS 4
.\}
.nf
$ clevis encrypt tpm2 \*(Aq{"pcr_ids":"0","pcr_digest":"xy7J5svCtqlfM03d1lE5gdoA8MI"}\*(Aq < PT > JWE
.fi
.if n \{\
.RE
.\}
.SH "THREAT MODEL"
.sp
The Clevis security model relies in the fact that an attacker will not be able to access both the encrypted data and the decryption key\&.
.sp
For most Clevis pins, the decryption key is not locally stored, so the decryption policy is only satisfied if the decryption key can be remotely accessed\&. It could for example be stored in a remote server or in a hardware authentication device that has to be plugged into the machine\&.
.sp
The tpm2 pin is different in this regard, since a key is wrapped by a TPM2 chip that is always present in the machine\&. This does not mean that there are not use cases for this pin, but it is important to understand the fact that an attacker that has access to both the encrypted data and the local TPM2 chip will be able to decrypt the data\&.
.SH "CONFIG"
.sp
This command uses the following configuration properties:
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBhash\fR
(string) : Hash algorithm used in the computation of the object name (default: sha256)
.sp
.if n \{\
.RS 4
.\}
.nf
It must be one of the following:
.fi
.if n \{\
.RE
.\}
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBsha1\fR
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBsha256\fR
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBsha384\fR
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBsha512\fR
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBsm3_256\fR
.RE
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBkey\fR
(string) : Algorithm type for the generated key (default: ecc)
.sp
.if n \{\
.RS 4
.\}
.nf
It must be one of the following:
.fi
.if n \{\
.RE
.\}
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBrsa\fR
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBkeyedhash\fR
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBecc\fR
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBsymcipher\fR
.RE
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBpcr_bank\fR
(string) : PCR algorithm bank to use for policy (default: sha1)
.sp
.if n \{\
.RS 4
.\}
.nf
It must be one of the following:
.fi
.if n \{\
.RE
.\}
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBsha1\fR
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBsha256\fR
.RE
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBpcr_ids\fR
(string) : Comma separated list of PCR used for policy\&. If not present, no policy is used
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
\fBpcr_digest\fR
(string) : Binary PCR hashes encoded in base64\&. If not present, the hash values are looked up
.RE
.SH "SEE ALSO"
.sp
\fBclevis\-decrypt\fR(1)
